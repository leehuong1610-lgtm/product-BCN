<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xác thực - Future Xion</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="auth-page">

    <div class="auth-box glass-box">
        <div id="auth-content-area"></div>
    </div>
    
    <script>
        const authContentArea = document.getElementById('auth-content-area');

        // Hàm hỗ trợ tạo label (giữ inline styles tối thiểu cho khả năng đọc)
        const createLabel = (text) => `<label style="display: block; text-align: left; font-size: 0.9em; margin-bottom: 5px; color: var(--color-text-dark);">${text}</label>`;

        // --- HÀM XỬ LÝ DỮ LIỆU HOẠT ĐỘNG ---
        function saveActivityData(userName, isNewUser = false) {
            let activities = [];

            if (!isNewUser) {
                const activitiesJson = localStorage.getItem('userActivities');
                activities = activitiesJson ? JSON.parse(activitiesJson) : [];

                if (activities.length === 0) {
                     isNewUser = true;
                }
            }
            
            if (isNewUser) {
                 // Thiết lập mảng rỗng cho người dùng mới
                 localStorage.setItem('userActivities', JSON.stringify([]));
            } else {
                 // Đăng nhập: Mô phỏng thêm hoạt động đăng nhập
                 const newActivity = {
                    id: Date.now(),
                    user: userName,
                    name: "Hoạt động Đăng nhập Hệ thống",
                    skill: "System Management",
                    date: new Date().toLocaleDateString('vi-VN'),
                    points: 10
                 };
                 activities.push(newActivity);
                 localStorage.setItem('userActivities', JSON.stringify(activities));
            }
        }
        // -------------------------------------------------------------------

        // --- 1. LOGIN (FRAME 166) ---
        const getLoginFrame = () => `
            <div class="icon-lock"><i class="fas fa-sun"></i></div>
            <h2>CHÀO MỪNG TRỞ LẠI!</h2>
            <p class="subtitle">Đăng nhập để truy cập Dashboard và hồ sơ kỹ năng của bạn.</p>
            
            <form onsubmit="handleAuthSubmit(event, 'login')">
                <div class="form-group">
                    ${createLabel('Tên người dùng')}
                    <input type="text" id="login-email" placeholder="Usename" required>
                </div>
                <div class="form-group">
                    ${createLabel('Mật khẩu')}
                    <input type="password" id="login-password" placeholder="********" required>
                    
                    <div class="remember-forgot-container">
                        <label class="custom-checkbox-label">
                            <input type="checkbox"> Remember me
                        </label>
                        <a href="#" onclick="renderFrame('forgot')" class="btn-link color-primary" style="font-weight: 500;">Forgot password?</a>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-submit-primary" style="width: 100%; margin-top: 20px;">Log in</button>
                
                <div class="auth-separator">Or</div>
                
                <button type="button" onclick="handleGoogleLogin()" class="btn btn-submit-google" style="background: var(--color-white); border: 1px solid var(--border-color); color: var(--color-text-dark); width: 100%; box-shadow: none;">
                    <i class="fab fa-google" style="color: #DB4437;"></i> Sign in with Google
                </button>
            </form>

            <p class="auth-footer color-text-medium" style="margin-top: 30px; font-size: 0.9em;">
                Don't have an account? <a href="#" onclick="renderFrame('register')" class="link-small color-primary" style="font-weight: 700; margin-left: 5px;">Sign up</a>
            </p>
        `;

        // --- 2. REGISTER (FRAME 167) ---
        const getRegisterFrame = () => `
            <div class="icon-lock"><i class="fas fa-user-circle"></i></div>
            <h2>Create Account</h2>
            <p class="subtitle">Đăng ký để bắt đầu đo lường kỹ năng mềm của bạn.</p>
            
            <form onsubmit="handleAuthSubmit(event, 'register')">
                <div class="form-group">${createLabel('Họ tên')}<input type="text" id="reg-name" placeholder="Full Name" required></div>
                <div class="form-group">${createLabel('Username')}<input type="text" id="reg-username" placeholder="Username" required></div>
                <div class="form-group">${createLabel('Email')}<input type="email" id="reg-email" placeholder="Email" required></div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                     <div class="form-group" style="margin-bottom: 0;">${createLabel('Ngày sinh')}<input type="date" id="reg-dob" required></div>
                     <div class="form-group" style="margin-bottom: 0;">${createLabel('Giới tính')}
                        <select id="reg-gender" required>
                            <option value="">Chọn</option>
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                            <option value="other">Khác</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 20px;">${createLabel('Trường Đại học')}<input type="text" id="reg-university" placeholder="Tên Trường Đại học" required></div>
                <div class="form-group">${createLabel('Mật khẩu')}<input type="password" id="reg-password" placeholder="Password" required></div>
                
                <label class="custom-checkbox-label" style="text-align: left; margin-top: -10px; margin-bottom: 15px;">
                    <input type="checkbox" required> I agree to all terms and Privacy Policy
                </label>

                <button type="submit" class="btn btn-primary btn-submit-primary" style="width: 100%;">Sign up</button>
                
                <div class="auth-separator">Or</div>
                
                <button type="button" onclick="handleGoogleLogin()" class="btn btn-submit-google" style="background: var(--color-white); border: 1px solid var(--border-color); color: var(--color-text-dark); width: 100%; box-shadow: none;">
                    <i class="fab fa-google" style="color: #DB4437;"></i> Sign in with Google
                </button>
            </form>

            <p class="auth-footer color-text-medium" style="margin-top: 30px; font-size: 0.9em;">
                Already have an account? <a href="#" onclick="renderFrame('login')" class="link-small color-primary" style="font-weight: 700; margin-left: 5px;">Log in</a>
            </p>
        `;

        // --- 3. FORGOT PASSWORD (FRAME 168) ---
        const getForgotFrame = () => `
            <div class="icon-lock"><i class="fas fa-lock"></i></div>
            <h2>Forgot your password?</h2>
            <p class="subtitle">Enter your email so that we can send you password reset link</p>
            
            <form onsubmit="handleAuthSubmit(event, 'forgot')">
                <div class="form-group">
                    ${createLabel('Email')}
                    <input type="email" id="forgot-email" placeholder="e.g. futurexion@gmail.com" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Send email</button>
                
                <a href="#" onclick="renderFrame('login')" class="btn-link color-primary" style="display: block; margin-top: 20px; font-weight: 500;">&lt; BACK TO LOGIN</a>
            </form>
        `;

        // --- 4. RESET PASSWORD (FRAME 169) ---
        const getResetFrame = () => `
            <div class="icon-lock"><i class="fas fa-envelope-open-text"></i></div>
            <h2>Reset password</h2>
            <p class="subtitle">Please kindly set your new password</p>
            
            <form onsubmit="handleAuthSubmit(event, 'reset')">
                <div class="form-group">
                    ${createLabel('New password')}
                    <input type="password" id="new-password" placeholder="Enter new password" required>
                    <p style="text-align: left; font-size: 0.8em; color: green; margin: 5px 0 0 0;">Password strength: Excellent</p>
                </div>
                <div class="form-group">
                    ${createLabel('Re-enter password')}
                    <input type="password" id="re-enter-password" placeholder="Re-enter password" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Cập nhật mật khẩu</button>
                
                <a href="#" onclick="renderFrame('login')" class="btn-link color-primary" style="display: block; margin-top: 20px; font-weight: 500;">&lt; BACK TO LOGIN</a>
            </form>
        `;

        // --- GOOGLE LOGIN (MOCK) ---
        function handleGoogleLogin() {
             const mockUserName = "Sinh viên Google";
             localStorage.setItem('currentUser', mockUserName);
             saveActivityData(mockUserName, true); 
             window.location.href = 'dashboard.html';
        }

        // --- SUBMISSION HANDLER (CẬP NHẬT) ---
        function handleAuthSubmit(event, flow) {
            event.preventDefault();
            
            if (flow === 'login') {
                const userName = document.getElementById('login-email')?.value || 'Sinh viên Tích cực';
                localStorage.setItem('currentUser', userName);
                saveActivityData(userName, false); 
                window.location.href = 'dashboard.html';
            } else if (flow === 'register') {
                 const userName = document.getElementById('reg-name')?.value || 'Sinh viên Tích cực';
                localStorage.setItem('currentUser', userName);
                saveActivityData(userName, true); 
                window.location.href = 'dashboard.html';
            } else if (flow === 'forgot') {
                renderFrame('reset');
            } else if (flow === 'reset') {
                renderFrame('login');
            }
        }

        // --- RENDER LOGIC VÀ KIỂM TRA HASH NAVIGATION ---
        function renderFrame(frameName) {
            let htmlContent = '';
            switch (frameName) {
                case 'register': htmlContent = getRegisterFrame(); break;
                case 'forgot': htmlContent = getForgotFrame(); break;
                case 'reset': htmlContent = getResetFrame(); break;
                case 'login': default: htmlContent = getLoginFrame(); break;
            }
            authContentArea.innerHTML = htmlContent;
        }

        // Khởi tạo trang với Frame Đăng nhập, kiểm tra hash cho Register
        document.addEventListener('DOMContentLoaded', () => {
            const hash = window.location.hash.substring(1);
            if (hash === 'register') {
                 renderFrame('register');
            } else {
                 renderFrame('login');
            }
        });
    </script>

</body>
</html>
