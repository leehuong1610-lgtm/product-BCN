<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding - Thiết lập Hồ sơ Kỹ năng</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="auth-page">

    <div class="auth-box" style="max-width: 650px; padding: 40px;">
        
        <div class="icon-lock"><i class="fas fa-route" style="font-size: 3em; background-image: linear-gradient(to right, #8C82FF, #4F9AFF); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i></div>
        <h2 style="font-size: 2.2em; margin-bottom: 5px;">Bắt đầu Lộ trình Phát triển</h2>
        <p class="subtitle" style="margin-bottom: 30px;">
            Hoàn thành 3 bước đơn giản để cá nhân hóa Dashboard của bạn.
        </p>
        
        <!-- BỘ CHỈ BÁO TIẾN TRÌNH 4 BƯỚC -->
        <div id="progress-indicator" style="display: flex; justify-content: space-between; margin-bottom: 40px; padding: 0 50px;">
            <div class="step-icon-container" data-step="1">
                <div class="step-circle active" id="circle-1">1</div>
                <small>Ngành học</small>
            </div>
            <div class="step-line" style="width: 60px; height: 2px; background-color: var(--color-background-muted); margin-top: 19px;"></div>
            <div class="step-icon-container" data-step="2">
                <div class="step-circle" id="circle-2">2</div>
                <small>Mục tiêu</small>
            </div>
             <div class="step-line" style="width: 60px; height: 2px; background-color: var(--color-background-muted); margin-top: 19px;"></div>
            <div class="step-icon-container" data-step="3">
                <div class="step-circle" id="circle-3">3</div>
                <small>Tự đánh giá</small>
            </div>
            <div class="step-line" style="width: 60px; height: 2px; background-color: var(--color-background-muted); margin-top: 19px;"></div>
            <div class="step-icon-container" data-step="4">
                <div class="step-circle" id="circle-4">4</div>
                <small>Hoàn tất</small>
            </div>
        </div>


        <form id="onboarding-form"> 
            <!-- BƯỚC 1: THÔNG TIN NGÀNH HỌC (GỐC) -->
            <div id="step-1" class="onboarding-step fade-in">
                <h3 style="font-size: 1.5em; color: var(--color-text-dark);">Bước 1: Thông tin Ngành học</h3>
                <p style="margin-bottom: 20px;">Chúng tôi cần thông tin này để so sánh bạn với điểm chuẩn thị trường.</p>
                <div class="form-group">
                    <label for="major" style="text-align: left;">Ngành học/Chuyên ngành của bạn:</label>
                    <input type="text" id="major" placeholder="Ví dụ: Marketing, Công nghệ thông tin..." required>
                </div>
                <div class="form-group">
                    <label for="university" style="text-align: left;">Trường Đại học:</label>
                    <input type="text" id="university" placeholder="Tên trường..." required>
                </div>
                <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="validateStep(1)">Tiếp theo</button>
            </div>


            <!-- BƯỚC 2: MỤC TIÊU KỸ NĂNG (CẬP NHẬT: CHỌN NHIỀU KỸ NĂNG) -->
            <div id="step-2" class="onboarding-step fade-in" style="display: none;">
                <h3 style="font-size: 1.5em; color: var(--color-text-dark);">Bước 2: Mục tiêu Kỹ năng Tập trung</h3>
                <p style="margin-bottom: 20px;">Chọn (tối thiểu 3) kỹ năng bạn muốn tập trung phát triển trong 6 tháng tới.</p>
                
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Kỹ năng muốn cải thiện:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: left;">
                        <label><input type="checkbox" name="focus_skill" value="Leadership"> Lãnh đạo</label>
                        <label><input type="checkbox" name="focus_skill" value="Communication"> Giao tiếp</label>
                        <label><input type="checkbox" name="focus_skill" value="Teamwork"> Làm việc nhóm</label>
                        <label><input type="checkbox" name="focus_skill" value="ProblemSolving"> Giải quyết Vấn đề</label>
                        <label><input type="checkbox" name="focus_skill" value="CriticalThinking"> Tư duy Phản biện</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="custom-skill">Thêm kỹ năng khác (nếu không có trong danh mục):</label>
                    <input type="text" id="custom-skill" placeholder="Ví dụ: Quản lý Xung đột, Đàm phán">
                </div>
                
                <button type="button" class="btn btn-secondary" style="width: 48%; margin-top: 20px; box-shadow: none;" onclick="transitionStep(1)">Quay lại</button>
                <button type="button" class="btn btn-primary" style="width: 48%; margin-top: 20px; float: right;" onclick="validateStep(2)">Tiếp theo</button>
            </div>
            
            <!-- BƯỚC 3: TỰ ĐÁNH GIÁ (SELF-ASSESSMENT) -->
            <div id="step-3" class="onboarding-step fade-in" style="display: none;">
                <h3 style="font-size: 1.5em; color: var(--color-text-dark);">Bước 3: Tự Đánh giá Mức độ Hiện tại</h3>
                <p style="margin-bottom: 20px;">Hãy tự đánh giá mức độ hiện tại của bạn (Thang 1.0 - 5.0). *Lưu ý: Điểm này là điểm khởi tạo và sẽ được thay thế bằng Web Rating khi bạn ghi nhận hoạt động.*</p>
                
                <div id="initial-assessment-sliders">
                    <!-- Sliders cho các kỹ năng cốt lõi (1.0 - 5.0) -->
                    <div class="form-group"><label for="self-slider-0" style="display: flex; justify-content: space-between;">Lãnh đạo: <span id="self-value-0">3.0</span></label><input type="range" id="self-slider-0" min="10" max="50" step="1" value="30" oninput="updateSelfAssessment(0, this.value)"></div>
                    <div class="form-group"><label for="self-slider-1" style="display: flex; justify-content: space-between;">Giao tiếp: <span id="self-value-1">3.0</span></label><input type="range" id="self-slider-1" min="10" max="50" step="1" value="30" oninput="updateSelfAssessment(1, this.value)"></div>
                    <div class="form-group"><label for="self-slider-2" style="display: flex; justify-content: space-between;">Giải quyết Vấn đề: <span id="self-value-2">3.0</span></label><input type="range" id="self-slider-2" min="10" max="50" step="1" value="30" oninput="updateSelfAssessment(2, this.value)"></div>
                    <div class="form-group"><label for="self-slider-3" style="display: flex; justify-content: space-between;">Làm việc nhóm: <span id="self-value-3">3.0</span></label><input type="range" id="self-slider-3" min="10" max="50" step="1" value="30" oninput="updateSelfAssessment(3, this.value)"></div>
                </div>

                <button type="button" class="btn btn-secondary" style="width: 48%; margin-top: 20px; box-shadow: none;" onclick="transitionStep(2)">Quay lại</button>
                <button type="button" class="btn btn-primary" style="width: 48%; margin-top: 20px; float: right;" onclick="handleOnboardingSubmit()">Hoàn tất & Đến Dashboard</button>
            </div>

        </form>
    </div>
    
    <script>
        let currentStep = 1;
        const totalSteps = 3; 
        const form = document.getElementById('onboarding-form');
        
        // Hàm cập nhật giá trị slider tự đánh giá
        function updateSelfAssessment(index, rawValue) {
            const newValue = parseFloat(rawValue / 10).toFixed(1); 
            document.getElementById(`self-value-${index}`).textContent = newValue;
        }

        // Hàm kiểm tra tính hợp lệ của các trường trong một bước
        function isStepValid(stepNumber) {
            const stepElement = document.getElementById(`step-${stepNumber}`);
            let valid = true;
            
            // Kiểm tra các trường required (chỉ áp dụng cho step 1)
            if (stepNumber === 1) {
                const requiredFields = stepElement.querySelectorAll('[required]');
                requiredFields.forEach(field => {
                    if (!field.value) {
                        valid = false;
                        // Sử dụng báo cáo hợp lệ của HTML5
                        field.reportValidity(); 
                    }
                });
            }

            // Kiểm tra đặc biệt cho Bước 2 (Chọn tối thiểu 3 kỹ năng)
            if (stepNumber === 2) {
                const checkedSkills = document.querySelectorAll('input[name="focus_skill"]:checked').length;
                if (checkedSkills < 3) {
                    // Cần có cách thông báo không dùng alert, ở đây tôi dùng báo cáo HTML5 cho trường đầu tiên
                    const firstCheckbox = document.querySelector('input[name="focus_skill"]');
                    firstCheckbox.setCustomValidity("Vui lòng chọn tối thiểu 3 kỹ năng để tập trung.");
                    firstCheckbox.reportValidity();
                    firstCheckbox.setCustomValidity(""); // Reset sau khi báo cáo
                    valid = false;
                }
            }
            return valid;
        }

        // Hàm chuyển bước (có kiểm tra)
        function validateStep(stepNumber) {
            if (isStepValid(stepNumber)) {
                transitionStep(stepNumber + 1);
            }
        }
        
        // Hàm chuyển bước với hiệu ứng
        function transitionStep(targetStep) {
            const currentElement = document.getElementById(`step-${currentStep}`);
            const targetElement = document.getElementById(`step-${targetStep}`);
            
            currentElement.style.opacity = '0';
            currentElement.style.transform = 'translateX(' + (targetStep > currentStep ? '-20px' : '20px') + ')';

            setTimeout(() => {
                currentElement.style.display = 'none';
                currentStep = targetStep;
                updateProgressIndicator(currentStep);

                targetElement.style.display = 'block';
                targetElement.style.transform = 'translateX(0)';
                targetElement.style.opacity = '1';
                
            }, 300);

            targetElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            currentElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        }


        // Hàm cập nhật chỉ báo tiến trình
        function updateProgressIndicator(step) {
            for (let i = 1; i <= totalSteps + 1; i++) { // totalSteps + 1 là 4 bước
                const circle = document.getElementById(`circle-${i}`);
                if (!circle) continue; 
                const small = circle.nextElementSibling;

                if (i < step) {
                    circle.classList.remove('active');
                    circle.classList.add('completed');
                    circle.innerHTML = '<i class="fas fa-check"></i>';
                    small.style.color = 'var(--color-accent)';
                } else if (i === step) {
                    circle.classList.add('active');
                    circle.classList.remove('completed');
                    circle.textContent = i === totalSteps + 1 ? 4 : i; // Vẫn hiển thị số bước hiện tại
                    small.style.color = 'var(--color-primary)';
                } else {
                    circle.classList.remove('active', 'completed');
                    circle.textContent = i;
                    small.style.color = 'var(--color-text-medium)';
                }
            }
        }

        // Xử lý nút Hoàn tất (sau Bước 3)
        function handleOnboardingSubmit() {
            // Bước 3 không có trường required nghiêm ngặt, chỉ cần đảm bảo người dùng đã qua
            
            // Giả lập bước cuối cùng (Bước 4: Hoàn tất)
            updateProgressIndicator(totalSteps + 1); 

            // Loại bỏ alert và chuyển hướng trực tiếp
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 500); 
        }

        // Thêm CSS nhỏ bổ sung cho hiệu ứng Stepper
        const style = document.createElement('style');
        style.innerHTML = `
            .step-circle {
                width: 40px; height: 40px; background-color: var(--color-background-muted); 
                color: var(--color-text-medium); border-radius: 50%; line-height: 40px;
                font-weight: 600; margin: 0 auto 5px auto; transition: all 0.3s ease;
                border: 2px solid var(--color-background-muted);
                display: flex; justify-content: center; align-items: center; /* Căn giữa nội dung */
            }
            .step-circle.active {
                background-color: var(--color-primary); color: white; border-color: var(--color-primary);
            }
            .step-circle.completed {
                background-color: var(--color-accent); color: var(--color-text-dark);
                font-size: 1.1em; line-height: 36px; border-color: var(--color-accent);
            }
            .onboarding-step {
                opacity: 0;
                transform: translateX(0);
                transition: opacity 0.3s ease, transform 0.3s ease;
            }
        `;
        document.head.appendChild(style);


        // Khởi tạo trạng thái ban đầu
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('step-1').style.display = 'block';
            document.getElementById('step-1').style.opacity = '1';
            updateProgressIndicator(currentStep);
        });
    </script>

</body>
</html>